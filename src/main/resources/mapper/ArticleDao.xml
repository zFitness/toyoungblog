<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="pers.zheng.blog.dao.ArticleDao">

    <resultMap type="pers.zheng.blog.model.entity.Article" id="XzArticlesMap">
        <result property="articleId" column="article_id" jdbcType="INTEGER"/>
        <result property="articleContent" column="article_content" jdbcType="VARCHAR"/>
        <result property="articleTitle" column="article_title" jdbcType="VARCHAR"/>
        <result property="articleViewCount" column="article_view_count" jdbcType="OTHER"/>
        <result property="articleLikeCount" column="article_like_count" jdbcType="OTHER"/>
        <result property="articleDate" column="article_date" jdbcType="TIMESTAMP"/>
        <result property="articleCommentCount" column="article_comment_count" jdbcType="OTHER"/>
    </resultMap>

    <select id="getArticleItem" resultType="pers.zheng.blog.model.vo.ArticleItemVo">
        SELECT
            article_id,
            article_title,
            article_view_count,
            article_like_count,
            article_comment_count,
            article_summary,
            article_date
        FROM
            ty_articles
        WHERE
            article_status like #{state}
        ORDER BY
	        article_date
        DESC
    </select>


    <select id="getArticleDtoItems" resultType="pers.zheng.blog.model.dto.ArticleItemDto">
        SELECT
            article_id,
            article_title,
            article_view_count,
            article_like_count,
            article_comment_count,
            article_summary,
            article_date,
            article_status
        FROM
            ty_articles
        ORDER BY
	        article_date
        DESC
    </select>

    <select id="getArticleById" resultType="pers.zheng.blog.model.vo.ArticleContentVo">
        SELECT
            article_id,
            article_content,
            article_date,
            article_like_count,
            article_title,
            article_comment_count,
            article_view_count
        FROM
            ty_articles
        WHERE article_id = #{articleId}
    </select>

    <select id="getArticleItemByLabel" resultType="pers.zheng.blog.model.vo.ArticleItemVo">
        SELECT
            a.article_id,
            a.article_title,
            a.article_view_count,
            a.article_comment_count,
            a.article_summary,
            a.article_date
        FROM
            ty_articles a
        JOIN
            ty_article_label b
        on
            a.article_id = b.article_id
        WHERE
	        b.label_id = #{labelId}
	    AND
	        a.article_status like #{state}
	    ORDER BY
        	a.article_date
        DESC
    </select>

    <select id="getArticleItemsByName" resultType="pers.zheng.blog.model.vo.ArticleItemVo">
        SELECT
            article_id,
            article_title,
            article_view_count,
            article_like_count,
            article_comment_count,
            article_summary,
            article_date
        FROM
            ty_articles
        WHERE
            article_title like concat('%', #{keyword}, '%')
        AND
            article_status like #{state}
	    ORDER BY
        	article_date
        DESC
    </select>


    <!-- 根据分类查询-->
    <select id="getArticleItemBySort" resultType="pers.zheng.blog.model.vo.ArticleItemVo">
        SELECT
            a.article_id,
            a.article_title,
            a.article_view_count,
            a.article_comment_count,
            a.article_summary,
            a.article_date
        FROM
            ty_articles a
            JOIN ty_article_sort b ON a.article_id = b.article_id
        WHERE
            b.sort_id = #{sortId}
            AND a.article_status LIKE #{state}
        ORDER BY
            a.article_date DESC
    </select>

    <select id="getPrevArticleItemByArticleId" resultType="pers.zheng.blog.model.vo.ArticleItemVo">
        SELECT
             *
        FROM
            ty_articles
        WHERE
             article_id = (
                SELECT
                    max( article_id )
                FROM
                    ty_articles
                WHERE
                    article_id &lt; #{articleId})
    </select>

    <select id="getNextArticleItemByArticleId" resultType="pers.zheng.blog.model.vo.ArticleItemVo">
        SELECT
            *
        FROM
            ty_articles
        WHERE
            article_id = ( SELECT min( article_id ) FROM ty_articles WHERE article_id > #{articleId} )
    </select>
</mapper>